<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Redaman Fiber Optik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .result-card {
            transition: all 0.3s ease-in-out;
            transform: scale(0.95);
            opacity: 0;
        }
        .result-card.show {
            transform: scale(1);
            opacity: 1;
        }
        .info-icon {
            cursor: pointer;
            position: relative;
            display: inline-block;
        }
        .info-tooltip {
            visibility: hidden;
            width: 220px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .info-tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        .info-icon:hover .info-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .copy-icon {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .copy-icon:hover {
            transform: scale(1.1);
        }
        .copy-feedback {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 md:p-8">
        
        <div class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Kalkulator Redaman Fiber Optik</h1>
            <p class="text-gray-500 mt-2">Alat bantu untuk profesional jaringan fiber optik.</p>
        </div>

        <!-- Input Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Kolom Kiri: Parameter Jaringan -->
            <div class="bg-gray-50 p-6 rounded-xl">
                <h2 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Parameter Jaringan</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="sourcePower" class="block text-sm font-medium text-gray-600 mb-1">Power OLT/Sumber (dBm)</label>
                        <input type="number" inputmode="decimal" step="any" id="sourcePower" value="7" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="distance" class="block text-sm font-medium text-gray-600 mb-1">Jarak Kabel (meter)</label>
                        <input type="number" inputmode="decimal" step="any" id="distance" value="10000" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="ratioSplitter" class="block text-sm font-medium text-gray-600 mb-1">Ratio Splitter</label>
                        <select id="ratioSplitter" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="plcSplitter" class="block text-sm font-medium text-gray-600 mb-1">PLC Splitter</label>
                        <select id="plcSplitter" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                </div>
                 <div class="text-xs text-gray-500 mt-4 flex items-center">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span class="info-tooltip">Kalkulasi ini menggunakan asumsi redaman kabel 0.22 dB/km (G.652.D @1550nm) dan total redaman 2 konektor sebesar 0.5 dB.</span>
                    </div>
                    <span class="ml-1">Menggunakan asumsi standar industri.</span>
                </div>
            </div>

            <!-- Kolom Kanan: Hasil Kalkulasi -->
            <div class="bg-indigo-50 p-6 rounded-xl flex flex-col justify-center">
                <h2 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Hasil Kalkulasi</h2>
                
                <div id="results" class="space-y-4">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DATA KONFIGURASI ---
            const ratioSplitterData = {
                '0': { label: 'Tanpa Ratio', loss1: 0, loss2: 0, note: 'Tidak ada pembagian sinyal' },
                '2': { label: '2:98', loss1: 18.5, loss2: 0.2, note: 'Port 1 (2%), Port 2 (98%)' },
                '3': { label: '3:97', loss1: 16.5, loss2: 0.2, note: 'Port 1 (3%), Port 2 (97%)' },
                '5': { label: '5:95', loss1: 14.0, loss2: 0.3, note: 'Port 1 (5%), Port 2 (95%)' },
                '10': { label: '10:90', loss1: 10.5, loss2: 0.6, note: 'Port 1 (10%), Port 2 (90%)' },
                '15': { label: '15:85', loss1: 9.0, loss2: 0.8, note: 'Port 1 (15%), Port 2 (85%)' },
                '20': { label: '20:80', loss1: 7.6, loss2: 1.1, note: 'Port 1 (20%), Port 2 (80%)' },
                '25': { label: '25:75', loss1: 6.5, loss2: 1.4, note: 'Port 1 (25%), Port 2 (75%)' },
                '30': { label: '30:70', loss1: 5.7, loss2: 1.7, note: 'Port 1 (30%), Port 2 (70%)' },
                '35': { label: '35:65', loss1: 5.0, loss2: 2.1, note: 'Port 1 (35%), Port 2 (65%)' },
                '40': { label: '40:60', loss1: 4.3, loss2: 2.5, note: 'Port 1 (40%), Port 2 (60%)' },
                '45': { label: '45:55', loss1: 3.8, loss2: 2.9, note: 'Port 1 (45%), Port 2 (55%)' },
                '50': { label: '50:50', loss1: 3.4, loss2: 3.4, note: 'Port 1 (50%), Port 2 (50%)' },
            };

            const plcSplitterData = {
                '0': { label: 'Tanpa Splitter', loss: 0 },
                '2': { label: '1:2', loss: 3.4 },
                '4': { label: '1:4', loss: 7.0 },
                '8': { label: '1:8', loss: 10.5 },
                '16': { label: '1:16', loss: 13.8 },
                '32': { label: '1:32', loss: 17.2 },
                '64': { label: '1:64', loss: 20.5 },
            };

            const CABLE_LOSS_PER_KM = 0.22;
            const CONNECTOR_LOSS = 0.5;

            // --- ELEMEN DOM ---
            const sourcePowerInput = document.getElementById('sourcePower');
            const distanceInput = document.getElementById('distance');
            const ratioSelect = document.getElementById('ratioSplitter');
            const plcSelect = document.getElementById('plcSplitter');
            const resultsDiv = document.getElementById('results');

            // --- FUNGSI ---
            function populateSelects() {
                Object.keys(ratioSplitterData).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = ratioSplitterData[key].label;
                    ratioSelect.appendChild(option);
                });
                Object.keys(plcSplitterData).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = plcSplitterData[key].label;
                    plcSelect.appendChild(option);
                });
            }

            function calculateAttenuation() {
                const sourcePower = parseFloat(sourcePowerInput.value) || 0;
                const distanceInMeters = parseFloat(distanceInput.value) || 0;
                const selectedRatioKey = ratioSelect.value;
                const selectedPlcKey = plcSelect.value;

                const distanceInKm = distanceInMeters / 1000;
                const cableLoss = distanceInKm * CABLE_LOSS_PER_KM;
                const baseLoss = cableLoss + CONNECTOR_LOSS;
                const powerBeforeSplitters = sourcePower - baseLoss;

                const ratioInfo = ratioSplitterData[selectedRatioKey];
                const powerAfterRatio1 = powerBeforeSplitters - ratioInfo.loss1;
                const powerAfterRatio2 = powerBeforeSplitters - ratioInfo.loss2;

                const plcInfo = plcSplitterData[selectedPlcKey];
                const finalPower = powerAfterRatio2 - plcInfo.loss;

                displayResults({
                    baseLoss,
                    powerBeforeSplitters,
                    ratioInfo,
                    powerAfterRatio1,
                    powerAfterRatio2,
                    plcInfo,
                    finalPower
                });
            }

            function displayResults(data) {
                const valBefore = data.powerBeforeSplitters.toFixed(2);
                const valRatio1 = data.powerAfterRatio1.toFixed(2);
                const valRatio2 = data.powerAfterRatio2.toFixed(2);
                const valFinal = data.finalPower.toFixed(2);

                resultsDiv.innerHTML = `
                    <div class="result-card bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm text-gray-500">Power Sebelum Splitter</p>
                                <p class="text-xl font-semibold text-indigo-600">${valBefore} dBm</p>
                                <p class="text-xs text-gray-400">Redaman dasar: ${data.baseLoss.toFixed(2)} dB</p>
                            </div>
                            <div class="relative">
                                <span class="copy-feedback">Disalin!</span>
                                <svg data-copy-value="${valBefore}" class="copy-icon h-6 w-6 text-gray-400 hover:text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                            </div>
                        </div>
                    </div>
                    <div class="result-card bg-white p-4 rounded-lg shadow-sm">
                        <p class="text-sm text-gray-500">Output Setelah Ratio Splitter</p>
                        <div class="flex justify-between items-center mt-1">
                            <div class="text-center relative">
                                <span class="text-lg font-medium text-gray-700">${valRatio1} dBm</span>
                                <svg data-copy-value="${valRatio1}" class="copy-icon h-5 w-5 inline-block ml-1 text-gray-400 hover:text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                <span class="copy-feedback">Disalin!</span>
                            </div>
                            <div class="text-center relative">
                                <span class="text-lg font-medium text-gray-700">${valRatio2} dBm</span>
                                <svg data-copy-value="${valRatio2}" class="copy-icon h-5 w-5 inline-block ml-1 text-gray-400 hover:text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                <span class="copy-feedback">Disalin!</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 text-center mt-1">${data.ratioInfo.note}</p>
                    </div>
                    <div class="result-card bg-indigo-600 text-white p-4 rounded-lg shadow-md">
                         <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm text-indigo-200">Output Akhir (Setelah PLC)</p>
                                <p class="text-2xl font-bold">${valFinal} dBm</p>
                                <p class="text-xs text-indigo-200 mt-1">Diasumsikan PLC pada Port 2</p>
                            </div>
                            <div class="relative">
                                <span class="copy-feedback">Disalin!</span>
                                <svg data-copy-value="${valFinal}" class="copy-icon h-6 w-6 text-indigo-200 hover:text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                            </div>
                        </div>
                    </div>
                `;
                
                const cards = resultsDiv.querySelectorAll('.result-card');
                cards.forEach((card, index) => {
                    setTimeout(() => card.classList.add('show'), index * 100);
                });
            }

            function copyToClipboard(text, element) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    const feedback = element.parentElement.querySelector('.copy-feedback');
                    feedback.style.opacity = '1';
                    setTimeout(() => {
                        feedback.style.opacity = '0';
                    }, 1500);
                } catch (err) {
                    console.error('Gagal menyalin teks: ', err);
                }
                document.body.removeChild(textarea);
            }

            // --- INISIALISASI & EVENT LISTENERS ---
            populateSelects();
            calculateAttenuation();

            [sourcePowerInput, distanceInput, ratioSelect, plcSelect].forEach(element => {
                element.addEventListener('input', calculateAttenuation);
            });

            resultsDiv.addEventListener('click', function(event) {
                const copyIcon = event.target.closest('.copy-icon');
                if (copyIcon) {
                    const valueToCopy = copyIcon.dataset.copyValue;
                    copyToClipboard(valueToCopy, copyIcon);
                }
            });
        });
    </script>
</body>
</html>
